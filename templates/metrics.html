{% extends "base.html" %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Financial Analysis Dashboard</h2>

    <a href="{{ url_for('upload_file') }}"
       class="btn btn-outline-success">
        Analyze New Data
    </a>
</div>

<!-- ===================== -->
<!-- PROFITABILITY -->
<!-- ===================== -->
<h4 class="mt-4">Profitability Analysis</h4>

<div class="row mb-3">
    {% for key, value in summary_metrics.items() %}
        {% if "ROE" in key or "ROA" in key or "Margin" in key %}
        <div class="col-md-3">
            <div class="card text-center p-3">
                <h6 class="text-muted">{{ key }}</h6>
                <h4>{{ value }}</h4>
            </div>
        </div>
        {% endif %}
    {% endfor %}
</div>

<div class="row">
    {% for plot in plots %}
        {% if "roe" in plot or "roa" in plot or "margin" in plot %}
        <div class="col-md-6 mb-3">
            <img src="{{ url_for('static', filename='plots/' + plot) }}"
                 class="img-fluid">
        </div>
        {% endif %}
    {% endfor %}
</div>

{% if interpretation.profitability %}
<p class="text-muted mt-2">
    {{ interpretation.profitability }}
</p>
{% endif %}

<hr>

<!-- ===================== -->
<!-- LIQUIDITY -->
<!-- ===================== -->
<h4 class="mt-4">Liquidity Analysis</h4>

<div class="row mb-3">
    {% for key, value in summary_metrics.items() %}
        {% if "Current Ratio" in key %}
        <div class="col-md-3">
            <div class="card text-center p-3">
                <h6 class="text-muted">{{ key }}</h6>
                <h4>{{ value }}</h4>
            </div>
        </div>
        {% endif %}
    {% endfor %}
</div>

<div class="row">
    {% for plot in plots %}
        {% if "current_ratio" in plot %}
        <div class="col-md-6 mb-3">
            <img src="{{ url_for('static', filename='plots/' + plot) }}"
                 class="img-fluid">
        </div>
        {% endif %}
    {% endfor %}
</div>

{% if interpretation.liquidity %}
<p class="text-muted mt-2">
    {{ interpretation.liquidity }}
</p>
{% endif %}

<hr>

<!-- ===================== -->
<!-- LEVERAGE -->
<!-- ===================== -->
<h4 class="mt-4">Leverage Analysis</h4>

<div class="row mb-3">
    {% for key, value in summary_metrics.items() %}
        {% if "Debt" in key %}
        <div class="col-md-3">
            <div class="card text-center p-3">
                <h6 class="text-muted">{{ key }}</h6>
                <h4>{{ value }}</h4>
            </div>
        </div>
        {% endif %}
    {% endfor %}
</div>

<div class="row">
    {% for plot in plots %}
        {% if "debt_equity" in plot %}
        <div class="col-md-6 mb-3">
            <img src="{{ url_for('static', filename='plots/' + plot) }}"
                 class="img-fluid">
        </div>
        {% endif %}
    {% endfor %}
</div>

{% if interpretation.leverage %}
<p class="text-muted mt-2">
    {{ interpretation.leverage }}
</p>
{% endif %}

<hr>

<!-- ===================== -->
<!-- FULL METRICS TABLE -->
<!-- ===================== -->
<h4 class="mt-4">Complete Financial Metrics (Multi-Year)</h4>
{% for table in tables %}
    {{ table | safe }}
{% endfor %}

<hr>

<!-- ===================== -->
<!-- EXPORT ACTIONS -->
<!-- ===================== -->
<a href="{{ url_for('download_report') }}"
   class="btn btn-success mt-3 me-2">
   Download PDF Report
</a>

<a href="{{ url_for('download_metrics') }}"
   class="btn btn-outline-primary mt-3">
   Download Metrics (CSV)
</a>

{% endblock %}
